<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QQ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="cdkModal" class="modal" style="display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center;">
    <div class="modal-content" style="background-color: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 400px;">
        <h2 style="text-align: center; margin-bottom: 20px;">卡密验证</h2>
        <form id="cdkForm" style="display: flex; flex-direction: column;">
            <input type="text" id="cdkInput" placeholder="请输入卡密" style="padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <p id="cdkMessage" style="color: red; text-align: center; height: 20px;"></p>
            <button type="submit" style="padding: 10px; background-color: #12b7f5; color: white; border: none; border-radius: 5px; cursor: pointer;">验证</button>
        </form>
    </div>
</div>
<div class="top-section">
<div class="box1">
    <div class="box1_left">
        <img src="./img/18.png" alt="">
    </div>
    <div class="box1_right">
        <img src="./img/17.png" alt="">
    </div>
</div>
</div>
<div class="bottom-section">
<div class="box2">
    <!-- 这是头像 -->
    <img src="./img/image7.png" id="avatar" class="avatar" alt="">
    <!-- 这是名字 -->
    <h2 id="name"></h2>
    <button>
        <img src="./img/14.png" alt="">
        <p>状态</p>
    </button>
    <div class="good">
        <img src="./img/good.png" alt="">
        <!-- 这是点赞 -->
        <p id="good"></p>
    </div>
</div>
<div class="box box3">
   <div>
        <section>
            <span>
                <img src="./img/35.png" class="i2" id="img19" alt="">
            </span>
            <!-- 这是QQ号 -->
            <p id="qq_number"></p>
        </section>
        <img src="./img/20.png" class="i3" alt="">
    </div>
</div>


<div class="box box4">
    <div class="box4_right">
        <img src="./img/33.png" alt="">
        <img src="./img/9.GIF" alt="">
        <img src="./img/88.gif" alt="">
    </div>
    <img src="./img/heart.png" style="opacity: 0" class="right" alt="">
</div>

<div class="box box5">
    <div class="box4_right">
        <img src="./img/21.png" class="img1" alt="" style="display: inline-block;">
        <img src="./img/22.png" class="img2" alt="" style="display: none;">
        <img src="./img/23.png" class="img3" alt="" style="display: none;">
        <img src="./img/31.png" class="img4" alt="" style="display: none;">
        <img src="./img/39.png" class="img5" alt="" style="display: none;">
        <img src="./img/36.png" class="img6" alt="" style="display: none;">
        <img src="./img/37.png" class="img7" alt="" style="display: none;">
        <img src="./img/38.png" class="img8" alt="" style="display: none;">
        <img src="./img/25.png" alt="">
        <img src="./img/24.png" alt="">
        <img src="./img/26.png" alt="">
        <img src="./img/27.png" alt="">
        <img src="./img/28.png" alt="">
        <img src="./img/29.png" alt="">
    </div>
    <img src="./img/heart.png" style="opacity: 0" class="right" alt="">
	<img src="./img/15.png" class="right" alt="">
</div>
<div class="box box6">
    <img src="./img/5.png" class="list" alt="">
    <div><p id="sign">编辑个签，展示我的独特态度</p></div>
</div>
<div class="add-tag-section">
    <button class="add-tag-btn">添加标签 +</button>
</div>
<div class="box box7">
    <img src="./img/1.png" class="list" alt="">
    <div>
        <p>资料完善度60%</p>
        <span>去完善</span>
</div>
<img src="./img/15.png" class="right" alt="">
</div>
<div class="box box8">
        <img src="./img/2.png" class="list" alt="">
		<div>
		    <p>QQ空间</p>
			<span>分享新鲜事</span>
		</div>
		<img src="./img/15.png" class="right" alt="">
    </div>

<div class="last">
    <button>
        <span>个性名片</span>
    </button>
    <button>
        <span>编辑资料</span>
    </button>
    <button id="editButton">
        <span>发消息</span>
    </button>
</div>
</div>
<div id="editModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close">×</span>
        <form id="editForm">
            <label for="avatarInput">头像:</label>
            <input type="file" id="avatarInput" accept="image/*">
            
            <label for="nameInput">名字:</label>
            <input type="text" id="nameInput">
            
            <label for="goodInput">点赞:</label>
            <input type="text" id="goodInput">
            
            <label for="qqNumberInput">QQ号:</label>
            <input type="text" id="qqNumberInput">
            
            <label for="signInput">签名:</label>
            <input type="text" id="signInput">

            <div class="vip-selection">
                <label>选择显示VIP图片:</label>
                <div class="vip-images-container">
                    <div class="vip-item">
                        <input type="radio" id="img1Radio" name="imageSelect" value="img1" checked>
                        <label for="img1Radio">
                            <img src="./img/21.png" alt="VIP1">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img2Radio" name="imageSelect" value="img2">
                        <label for="img2Radio">
                            <img src="./img/22.png" alt="VIP2">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img3Radio" name="imageSelect" value="img3">
                        <label for="img3Radio">
                            <img src="./img/23.png" alt="VIP3">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img4Radio" name="imageSelect" value="img4">
                        <label for="img4Radio">
                            <img src="./img/31.png" alt="VIP4">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img5Radio" name="imageSelect" value="img5">
                        <label for="img5Radio">
                            <img src="./img/39.png" alt="VIP5">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img6Radio" name="imageSelect" value="img6">
                        <label for="img6Radio">
                            <img src="./img/36.png" alt="VIP6">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img7Radio" name="imageSelect" value="img7">
                        <label for="img7Radio">
                            <img src="./img/37.png" alt="VIP7">
                        </label>
                    </div>
                    <div class="vip-item">
                        <input type="radio" id="img8Radio" name="imageSelect" value="img8">
                        <label for="img8Radio">
                            <img src="./img/38.png" alt="VIP8">
                        </label>
                    </div>
                </div>
            </div>

            <input type="submit" value="保存">
        </form>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // 从缓存中读取数据
        const avatar = localStorage.getItem("avatar");
        const name = localStorage.getItem("name");
        const good = localStorage.getItem("good");
        const qqNumber = localStorage.getItem("qqNumber");
        const sign = localStorage.getItem("sign");

        if (avatar) {
            const avatarImg = document.getElementById("avatar");
            avatarImg.src = avatar;
        }
        if (name) {
            document.getElementById("name").textContent = name;
        }
        if (good) {
            document.getElementById("good").textContent = good;
        }
        if (qqNumber) {
            document.getElementById("qq_number").textContent = qqNumber;
        }
        if (sign) {
            document.querySelector("#sign").textContent = sign;
        }

        const selectedImage = localStorage.getItem("selectedImage");
        if (selectedImage) {
            const radio = document.getElementById(`${selectedImage}Radio`);
            if (radio) {
                radio.checked = true;
                showSelectedImage(selectedImage);
            }
        } else {
            showSelectedImage("img1");
        }
    });
    
    // 显示选中的图片
    function showSelectedImage(selected) {
        const images = ["img1", "img2", "img3", "img4", "img5", "img6", "img7", "img8"];
        images.forEach((img) => {
            const imgElement = document.querySelector(`.${img}`);
            if (imgElement) {
                imgElement.style.display = img === selected ? "inline-block" : "none";
            }
        });
    }

    // 监听单选框变化
    const radioButtons = document.querySelectorAll('input[name="imageSelect"]');
    radioButtons.forEach((radio) => {
        radio.addEventListener("change", () => {
            if (radio.checked) {
                const selectedImage = radio.value;
                showSelectedImage(selectedImage);
            }
        });
    });
    
    // 获取元素
    const editButton = document.getElementById("editButton");
    const modal = document.getElementById("editModal");
    const closeButton = document.querySelector(".close");
    const editForm = document.getElementById("editForm");

    // 打开弹窗
    editButton.addEventListener("click", () => {
        modal.style.display = "block";
        
        // 从缓存中读取数据并填入表单
        const name = localStorage.getItem("name") || "";
        const good = localStorage.getItem("good") || "";
        const qqNumber = localStorage.getItem("qqNumber") || "";
        const sign = localStorage.getItem("sign") || "";
        const selectedImage = localStorage.getItem("selectedImage") || "img1";

        document.getElementById("nameInput").value = name;
        document.getElementById("goodInput").value = good;
        document.getElementById("qqNumberInput").value = qqNumber;
        document.getElementById("signInput").value = sign;
        
        // 设置选中的图片
        const radio = document.getElementById(`${selectedImage}Radio`);
        if (radio) {
            radio.checked = true;
        }
    });

    // 关闭弹窗
    closeButton.addEventListener("click", () => {
        modal.style.display = "none";
    });

    // 点击窗口外关闭弹窗
    window.addEventListener("click", (event) => {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });

    // 处理表单提交 - 修复保存功能
    editForm.addEventListener("submit", (event) => {
        event.preventDefault();

        const avatarInput = document.getElementById("avatarInput");
        const nameInput = document.getElementById("nameInput");
        const goodInput = document.getElementById("goodInput");
        const qqNumberInput = document.getElementById("qqNumberInput");
        const signInput = document.getElementById("signInput");

        // 获取选中的图片
        const selectedRadio = document.querySelector('input[name="imageSelect"]:checked');
        if (selectedRadio) {
            const selectedImage = selectedRadio.value;
            localStorage.setItem("selectedImage", selectedImage);
            showSelectedImage(selectedImage);
        }

        // 处理头像上传
        if (avatarInput.files.length > 0) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const avatar = e.target.result;
                localStorage.setItem("avatar", avatar);
                const avatarImg = document.getElementById("avatar");
                avatarImg.src = avatar;
            };
            reader.readAsDataURL(avatarInput.files[0]);
        }

        // 保存其他数据
        const name = nameInput.value.trim();
        const good = goodInput.value.trim();
        const qqNumber = qqNumberInput.value.trim();
        const sign = signInput.value.trim();

        // 保存到本地存储
        localStorage.setItem("name", name);
        localStorage.setItem("good", good);
        localStorage.setItem("qqNumber", qqNumber);
        localStorage.setItem("sign", sign);

        // 更新页面显示
        document.getElementById("name").textContent = name;
        document.getElementById("good").textContent = good;
        document.getElementById("qq_number").textContent = qqNumber;
        document.querySelector("#sign").textContent = sign;

        // 关闭弹窗
        modal.style.display = "none";
    });
    
    // 卡密验证处理
    const cdkModal = document.getElementById("cdkModal");
    const cdkForm = document.getElementById("cdkForm");
    const cdkMessage = document.getElementById("cdkMessage");

    // 检查是否已经验证过卡密
    const isVerified = localStorage.getItem("cdkVerified");
    if(isVerified === "true") {
        cdkModal.style.display = "none";
    } else {
        cdkModal.style.display = "flex";
    }

    // 处理卡密表单提交
    cdkForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const cdk = document.getElementById("cdkInput").value;

        // 正确的卡密
        const correctCdk = "886";

        if(cdk === correctCdk) {
            cdkMessage.textContent = "验证成功！";
            cdkMessage.style.color = "green";
            localStorage.setItem("cdkVerified", "true");
            setTimeout(() => {
                cdkModal.style.display = "none";
            }, 1000);
        } else {
            cdkMessage.textContent = "卡密错误，请重新输入！";
            cdkMessage.style.color = "red";
        }
    });
</script>
</body>
</html>